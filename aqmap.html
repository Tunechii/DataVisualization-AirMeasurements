<!DOCTYPE html>
<html>
<head>
  <title>Air Quality Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    #map { height: 600px; width: 100%; }
  </style>
</head>
<body>
  <h2>Air Quality Map of Greece</h2>
  <div id="map"></div>

  <script>
    const cityCoords = {
    "Athens": [37.9838, 23.7275],
    "Heraklion": [35.341846, 25.148254],
    "Thessaloniki": [40.6401, 22.9444],
    "Patras": [38.24444, 21.73444],
    "Larissa": [39.643452, 	22.413208],
    "Chania": [35.51124, 24.02921]

};

    const map = L.map('map').setView([38.5, 23.7], 6);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    // Fetch pollution data from backend
    fetch('/map_data')
      .then(response => response.json())
      .then(data => {
        Object.keys(data).forEach(city => {
          const value = data[city];
          const coords = cityCoords[city];

          if (coords) {
            const color =
              value < 100 ? "green" :
              value < 200 ? "yellow" :
              value < 300 ? "orange" : "red";

            L.circleMarker(coords, {
              radius: 20,
              color: color,
              fillColor: color,
              fillOpacity: 0.6
            })
            .addTo(map)
            .bindPopup(`<b>${city}</b><br>Avg Pollution: ${value.toFixed(1)}`);
          }
        });
      });
  </script>
</body>
</html>
